@model Cafeteria.Models.Purchase

@{
    ViewBag.Title = "Create";
}

<h2>Create</h2>


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>Purchase</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.PurchaseId, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.PurchaseId, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.PurchaseId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.ClientName, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.ClientName, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.ClientName, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-md-2">Producto</label>
            <div class="col-md-10">
                <select name="ProductId" class="form-control product" id="productName">
                    <option selected disabled>Elige un producto</option>
                    @foreach (var item in ViewBag.Products)
                    {
                        <option value="@item.Id">@item.ProductName</option>
                    }
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-md-2">Precio</label>
            <div class="col-md-10">
                <input type="text" class="form-control" id="productPrice" />
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Quantity, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <input type="text" name="Quantity" class="form-control" id="txtCantidad" />
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Total, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <input type="text" name="Total" class="form-control" id="txtTotal" readonly />
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Comment, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <input type="text" name="Comment" class="form-control" />
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Status, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Status, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Status, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="modal fade" id="totalModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">¡Confirma tu compra!</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="lblModal"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Regresar</button>
                        <input type="submit" value="Aceptar" class="btn btn-default" data-toggle="modal" data-target="#totalModal" />
                    </div>
                </div>
            </div>
        </div>

    </div>
    <button id="btnComprar">Conocer mi compra</button>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script type="text/javascript">

       $(document).ready(function () {
            $('#productName').change(function () {
                var precio;
                precio = $('#productName option:selected').val();
                $('#productPrice').val(precio);
        });
        });

        $(function () {
            $('#btnComprar').on("click", function () {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetPrice", "Purchases")',
                    data: { 'id': $('#productPrice').val() },
                    datatype: 'json',
                })
                    .success(function (data) {
                        var cantidad, precio, total;
                        precio = $('#productPrice').val(data.precio);
                        cantidad = $('#txtCantidad').val();
                        total = cantidad * precio;
                        $('#txtTotal').val(total);
                    })
                    .error(function (xhr, ajaxOptions, thrownError) {
                        $('#lblMessage').html("Ha ocurrido un error.");
                    });
                return false;
            });

            @*$(document).ready(function(){
            $('#txtCantidad').change(function(){
                        var cantidad;
                        cantidad = $('#txtCantidad').val();
            $('#txtTotal').val(cantidad);
            $('txtCantdad').val(cantidad);
            });
            });*@
        });

    </script>
}
